define("format_multitopic/courseformat/courseindex/section",["exports","core_courseformat/local/courseindex/section"],(function(_exports,_section){var obj;
/**
   * Course index section component.
   *
   * This component is used to control specific course section interactions like drag and drop.
   *
   * @module     format_multitopic/courseformat/courseindex/section
   * @class      format_multitopic/courseformat/courseindex/section
   * @copyright  2022 James Calder and Otago Polytechnic
   * @copyright  based on work by 2021 Ferran Recio <ferran@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_section=(obj=_section)&&obj.__esModule?obj:{default:obj};class Component extends _section.default{static init(target,selectors){return new Component({element:document.getElementById(target),selectors:selectors})}validateDropData(dropdata){if("cm"===(null==dropdata?void 0:dropdata.type))return!0;if("section"===(null==dropdata?void 0:dropdata.type)){const sectionzeroid=this.course.sectionlist[0],state=this.reactive.stateManager.state,origin=state.section.get(dropdata.id);let target=this.section;for(;target.levelsan>origin.levelsan;)target=state.section.get(this.course.sectionlist[target.number-1]);const moveDirection=Math.sign(target.number-origin.number);let targetEnd=target;for(;this.course.sectionlist.length>targetEnd.number+1&&state.section.get(this.course.sectionlist[targetEnd.number+1]).levelsan>origin.levelsan;)targetEnd=state.section.get(this.course.sectionlist[targetEnd.number+1]);return origin.id!=target.id&&origin.id!=sectionzeroid&&target.id!=sectionzeroid&&this.id==(moveDirection>0?targetEnd:target).id}return!1}showDropZone(dropdata){var _this$getLastCm;"cm"==dropdata.type&&(null===(_this$getLastCm=this.getLastCm())||void 0===_this$getLastCm||_this$getLastCm.classList.add(this.classes.DROPDOWN));if("section"==dropdata.type){const state=this.reactive.stateManager.state,origin=state.section.get(dropdata.id);let target=this.section;for(;target.levelsan>origin.levelsan;)target=state.section.get(this.course.sectionlist[target.number-1]);const moveDirection=Math.sign(target.number-origin.number);let targetEnd=target;for(;this.course.sectionlist.length>targetEnd.number+1&&state.section.get(this.course.sectionlist[targetEnd.number+1]).levelsan>origin.levelsan;)targetEnd=state.section.get(this.course.sectionlist[targetEnd.number+1]);const targetHTML=document.querySelector(".courseindex-section[data-id='"+(moveDirection<=0?target:targetEnd).id+"']");moveDirection>0?(targetHTML.classList.remove(this.classes.DROPUP),targetHTML.classList.add(this.classes.DROPDOWN)):(targetHTML.classList.add(this.classes.DROPUP),targetHTML.classList.remove(this.classes.DROPDOWN))}}hideDropZone(dropdata){const state=this.reactive.stateManager.state,origin=state.section.get(dropdata.id);let target=this.section;for(;target.levelsan>origin.levelsan;)target=state.section.get(this.course.sectionlist[target.number-1]);const moveDirection=Math.sign(target.number-origin.number);let targetEnd=target;for(;this.course.sectionlist.length>targetEnd.number+1&&state.section.get(this.course.sectionlist[targetEnd.number+1]).levelsan>origin.levelsan;)targetEnd=state.section.get(this.course.sectionlist[targetEnd.number+1]);const targetHTML=document.querySelector(".courseindex-section[data-id='"+(moveDirection<=0?target:targetEnd).id+"']");targetHTML.classList.remove(this.classes.DROPUP),targetHTML.classList.remove(this.classes.DROPDOWN)}drop(dropdata){if("cm"==dropdata.type&&this.reactive.dispatch("cmMove",[dropdata.id],this.id),"section"==dropdata.type){const state=this.reactive.stateManager.state,origin=state.section.get(dropdata.id);let target=this.section;for(;target.levelsan>origin.levelsan;)target=state.section.get(this.course.sectionlist[target.number-1]);this.reactive.dispatch("fmtSectionMove",origin,target)}}_refreshSection(_ref){let{element:element}=_ref;super._refreshSection({element:element});const linkHTML=this.element.querySelector("a.courseindex-link"),link=element.sectionurl.replace("&amp;","&");linkHTML.href!=link&&(linkHTML.href=link)}}return _exports.default=Component,_exports.default}));

//# sourceMappingURL=section.min.js.map