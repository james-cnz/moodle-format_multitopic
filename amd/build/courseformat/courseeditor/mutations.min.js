define("format_multitopic/courseformat/courseeditor/mutations",["exports","core/ajax","core_courseformat/courseeditor","core_courseformat/local/courseeditor/mutations","core_courseformat/local/content/actions"],(function(_exports,_ajax,_courseeditor,_mutations,_actions){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_mutations=_interopRequireDefault(_mutations),_actions=_interopRequireDefault(_actions);class MultitopicMutations extends _mutations.default{constructor(){super(...arguments),_defineProperty(this,"sectionMoveAfter",(async function(stateManager,sectionIds,targetSectionId){if(!targetSectionId)throw new Error("Mutation sectionMoveAfter requires targetSectionId");const course=stateManager.get("course");let subsectionIds=[];for(const sectionId of sectionIds){const section=stateManager.get("section",sectionId);for(let subsection=section;subsection&&(subsection.id==section.id||subsection.levelsan>section.levelsan);subsection=course.sectionlist.length>subsection.number+1?stateManager.get("section",course.sectionlist[subsection.number+1]):null)subsectionIds.push(subsection.id)}this.sectionLock(stateManager,subsectionIds,!0);const updates=await this._callEditWebservice("section_move_after",course.id,sectionIds,targetSectionId);"function"==typeof this.bulkReset&&this.bulkReset(stateManager),stateManager.processUpdates(updates),this.sectionLock(stateManager,subsectionIds,!1)})),_defineProperty(this,"fmtSectionMoveInto",(async function(stateManager,sectionIds,targetSectionId){if(!targetSectionId)throw new Error("Mutation sectionMoveInto requires targetSectionId");const course=stateManager.get("course");let subsectionIds=[];for(const sectionId of sectionIds){const section=stateManager.get("section",sectionId);for(let subsection=section;subsection&&(subsection.id==section.id||subsection.levelsan>section.levelsan);subsection=course.sectionlist.length>subsection.number+1?stateManager.get("section",course.sectionlist[subsection.number+1]):null)subsectionIds.push(subsection.id)}this.sectionLock(stateManager,subsectionIds,!0);const updates=await this._callEditWebservice("fmt_section_move_into",course.id,sectionIds,targetSectionId);"function"==typeof this.bulkReset&&this.bulkReset(stateManager),stateManager.processUpdates(updates),this.sectionLock(stateManager,subsectionIds,!1)})),_defineProperty(this,"fmtPageRaise",(async function(stateManager,sectionIds){if(1!=sectionIds.length)throw new Error("Mutation fmtPageRaise requires exactly one section ID.");const course=stateManager.get("course"),section=stateManager.get("section",sectionIds[0]);if(1!=section.levelsan)throw new Error("Mutation fmtPageRaise requires section level 1.");const targetSectionId=section.parentid;let subsectionIds=[];for(const sectionId of sectionIds){const section=stateManager.get("section",sectionId);for(let subsection=section;subsection&&(subsection.id==section.id||subsection.levelsan>section.levelsan);subsection=course.sectionlist.length>subsection.number+1?stateManager.get("section",course.sectionlist[subsection.number+1]):null)subsectionIds.push(subsection.id)}this.sectionLock(stateManager,subsectionIds,!0);const updates=await this._callEditWebservice("section_move_after",course.id,sectionIds,targetSectionId,section.levelsan-1);this.bulkReset(stateManager),stateManager.processUpdates(updates),this.sectionLock(stateManager,subsectionIds,!1)})),_defineProperty(this,"fmtPageLower",(async function(stateManager,sectionIds){if(1!=sectionIds.length)throw new Error("Mutation fmtPageLower requires exactly one section ID.");const course=stateManager.get("course"),section=stateManager.get("section",sectionIds[0]);if(0!=section.levelsan)throw new Error("Mutation fmtPageLower requires section level 0.");const targetSectionId=section.prevupid;let subsectionIds=[];for(const sectionId of sectionIds){const section=stateManager.get("section",sectionId);for(let subsection=section;subsection&&(subsection.id==section.id||subsection.levelsan>section.levelsan);subsection=course.sectionlist.length>subsection.number+1?stateManager.get("section",course.sectionlist[subsection.number+1]):null)subsectionIds.push(subsection.id)}this.sectionLock(stateManager,subsectionIds,!0);const updates=await this._callEditWebservice("fmt_section_move_into",course.id,sectionIds,targetSectionId,section.levelsan+1);this.bulkReset(stateManager),stateManager.processUpdates(updates),this.sectionLock(stateManager,subsectionIds,!1)}))}async _callEditWebservice(action,courseId,ids,targetSectionId,targetCmId){const args={action:action,courseid:courseId,ids:ids};targetSectionId&&(args.targetsectionid=targetSectionId),void 0!==targetCmId&&(args.targetcmid=targetCmId);let ajaxresult=await _ajax.default.call([{methodname:"core_courseformat_update_course",args:args}])[0];return JSON.parse(ajaxresult)}}_exports.init=()=>{(0,_courseeditor.getCurrentCourseEditor)().addMutations(new MultitopicMutations),_actions.default.addActions({fmtPageRaise:"fmtPageRaise",fmtPageLower:"fmtPageLower"})}}));

//# sourceMappingURL=mutations.min.js.map